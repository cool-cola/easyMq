#!/bin/bash
#set -x

PROC="mq_server"
SUFFIX=".bin"
MCP=$PROC"_mcp"$SUFFIX
SCC=$PROC"_scc"$SUFFIX
CCS=$PROC"_ccs"

doStart()
{
	echo start
	ALLRPOC="$MCP $SCC $CCS"
	for BIN in $ALLRPOC
	do
		echo $BIN
		FILENAME=`basename $0`
		NUM=`ps -fu ${USER} |grep $BIN" ../etc/"$BIN".cfg" |grep -v grep|grep -v ${FILENAME}|wc -l`
		if [ $NUM -le 0 ]
		then
			echo "./$BIN ../etc/$BIN.cfg"
			./$BIN ../etc/$BIN.cfg
		fi
	done
}


doStop()
{
	echo "stoping ${PROC}...!"

	PIDS=`pidof $MCP $CCS $SCC`
	echo $PIDS

	KILL=0
	for PID in $PIDS
	do
		kill -s USR2 $PID
		KILL=1
	done

	if [ $KILL = 1 ]
	then
		echo "stop ${PROC} ok!"
	else
		echo "Nothing stop!"
	fi

	########## clear shm #######
	#./clearshm.sh 0
}

doStatus()
{

	ps -ef | grep -E "$MCP|$CCS|$SCC" | grep -v grep
}

opt=$1
case "$opt" in
	"start" )
		doStart
		;;
	"stop" )
		echo stop
		doStop
		;;
	"status" )
		doStatus
		;;
	"restart" )
		doStop
		doStart
	;;
	#TODO: other options
esac

